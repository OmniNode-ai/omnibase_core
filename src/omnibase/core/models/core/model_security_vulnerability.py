"""
Security vulnerability model for security assessments.
"""

from datetime import datetime
from typing import List, Optional

from pydantic import BaseModel, Field, field_serializer

from omnibase.model.core.enum_security_risk_level import SecurityRiskLevel


class ModelSecurityVulnerability(BaseModel):
    """Individual security vulnerability."""

    vulnerability_id: str = Field(
        ..., description="Vulnerability identifier (e.g., CVE-ID)"
    )
    severity: SecurityRiskLevel = Field(..., description="Vulnerability severity")
    description: str = Field(..., description="Vulnerability description")
    affected_components: List[str] = Field(
        default_factory=list, description="Affected components"
    )
    remediation: Optional[str] = Field(None, description="Remediation steps")
    discovered_date: Optional[datetime] = Field(None, description="When discovered")
    fixed_date: Optional[datetime] = Field(None, description="When fixed")

    @field_serializer("discovered_date", "fixed_date")
    def serialize_datetime(self, value):
        if value and isinstance(value, datetime):
            return value.isoformat()
        return value
