"""
Security vulnerability model for security assessments.
"""

from datetime import datetime

from pydantic import BaseModel, Field, field_serializer

from omnibase_core.models.core.enum_security_risk_level import SecurityRiskLevel


class ModelSecurityVulnerability(BaseModel):
    """Individual security vulnerability."""

    vulnerability_id: str = Field(
        ...,
        description="Vulnerability identifier (e.g., CVE-ID)",
    )
    severity: SecurityRiskLevel = Field(..., description="Vulnerability severity")
    description: str = Field(..., description="Vulnerability description")
    affected_components: list[str] = Field(
        default_factory=list,
        description="Affected components",
    )
    remediation: str | None = Field(None, description="Remediation steps")
    discovered_date: datetime | None = Field(None, description="When discovered")
    fixed_date: datetime | None = Field(None, description="When fixed")

    @field_serializer("discovered_date", "fixed_date")
    def serialize_datetime(self, value):
        if value and isinstance(value, datetime):
            return value.isoformat()
        return value
