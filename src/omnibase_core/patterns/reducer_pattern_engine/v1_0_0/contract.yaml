# Reducer Pattern Engine - ONEX Contract
# Multi-workflow execution pattern with instance isolation and enhanced metrics

# === REQUIRED ROOT FIELDS ===
name: "reducer_pattern_engine"
version: {major: 1, minor: 0, patch: 0}
contract_version: {major: 1, minor: 0, patch: 0}
node_name: "reducer_pattern_engine"
node_version: {major: 1, minor: 0, patch: 0}
contract_name: "reducer_pattern_engine_contract"
description: "Multi-workflow reducer pattern engine with ONEX compliance"
node_type: "REDUCER"
input_model: "ModelReducerPatternEngineInput"
output_model: "ModelReducerPatternEngineOutput"

# === PATTERN CONFIGURATION ===
pattern_type: "execution_pattern"
supported_workflows: ["DATA_ANALYSIS", "DOCUMENT_REGENERATION", "REPORT_GENERATION"]

features:
  instance_isolation: true
  concurrent_processing: true
  enhanced_metrics: true
  registry_system: true
  state_management: true
  routing_optimization: true

max_concurrent_workflows: 100
isolation_level: "instance_based"
architecture: "multi_workflow"

# === COMPONENT SPECIFICATIONS ===
components:
  engine:
    class_name: "ReducerPatternEngine"
    module: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.engine"
    description: "Main pattern engine for workflow processing"

  router:
    class_name: "WorkflowRouter"
    module: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.engine"
    description: "Workflow routing and dispatch component"

  registry:
    class_name: "ReducerSubreducerRegistry"
    module: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.registry"
    description: "Subreducer registration and management"

  metrics:
    class_name: "ReducerMetricsCollector"
    module: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.metrics"
    description: "Performance metrics collection and monitoring"

# === SUBREDUCER SPECIFICATIONS ===
subreducers:
  data_analysis:
    class_name: "ReducerDataAnalysisSubreducer"
    module: "omnibase_core.patterns.reducer_pattern_engine.subreducers.reducer_data_analysis"
    supported_workflows: ["DATA_ANALYSIS"]
    capabilities: ["data_processing", "statistical_analysis", "visualization"]

  document_regeneration:
    class_name: "ReducerDocumentRegenerationSubreducer"
    module: "omnibase_core.patterns.reducer_pattern_engine.subreducers.reducer_document_regeneration"
    supported_workflows: ["DOCUMENT_REGENERATION"]
    capabilities: ["content_generation", "template_processing", "format_conversion"]

  report_generation:
    class_name: "ReducerReportGenerationSubreducer"
    module: "omnibase_core.patterns.reducer_pattern_engine.subreducers.reducer_report_generation"
    supported_workflows: ["REPORT_GENERATION"]
    capabilities: ["report_formatting", "data_aggregation", "chart_generation"]

# === FSM STATE MANAGEMENT (Reference to existing contract) ===
state_transitions:
  $ref: "state_management_contract.yaml"

# === ACTIONS ===
actions:
  - name: "process_workflow"
    description: "Process workflow through appropriate subreducer"
    inputs: ["workflow_request"]
    outputs: ["workflow_response"]

  - name: "health_check"
    description: "Check engine health and subreducer availability"
    inputs: []
    outputs: ["health_status"]

  - name: "get_metrics"
    description: "Get comprehensive processing metrics"
    inputs: []
    outputs: ["metrics_data"]

# === DEPENDENCIES ===
dependencies:
  - name: "container"
    type: "protocol"
    class_name: "ProtocolContainer"
    module: "omnibase.protocol.protocol_container"
  - name: "event_bus"
    type: "protocol"
    class_name: "ProtocolEventBus"
    module: "omnibase.protocol.protocol_event_bus"
  - name: "schema_loader"
    type: "protocol"
    class_name: "ProtocolSchemaLoader"
    module: "omnibase.protocol.protocol_schema_loader"

# === PERFORMANCE ===
performance:
  single_operation_max_ms: 30000
  batch_operation_max_s: 300
  memory_limit_mb: 2048
  cpu_limit_percent: 80
  throughput_min_ops_per_second: 10.0

# === LIFECYCLE CONFIGURATION ===
lifecycle:
  initialization_timeout_s: 60
  cleanup_timeout_s: 30
  error_recovery_enabled: true
  state_persistence_enabled: true
  health_check_interval_s: 30

# === DEFINITIONS (Required by ModelContractContent) ===
definitions:
  models: {}
  schemas: {}
  responses: {}

# === SUBCONTRACTS ===
subcontracts:
  - path: "contracts/state_management_contract.yaml"
    integration_field: "state_management_configuration"

# === VALIDATION RULES ===
validation_rules:
  - field: "workflow_type"
    type: "string"
    required: true
    allowed_values: ["DATA_ANALYSIS", "DOCUMENT_REGENERATION", "REPORT_GENERATION"]
  - field: "instance_id"
    type: "string"
    required: true
