# Reducer Pattern Engine v1.0.0 Contract Manifest
# ONEX Standards Compliant Pattern Contract

name: "reducer_pattern_engine"
version: "1.0.0"
description: "Multi-workflow reducer pattern engine with instance isolation and enhanced metrics collection"
node_type: "COMPUTE"

# Input/Output Models
input_model: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.contracts.WorkflowRequest"
output_model: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.contracts.WorkflowResponse"

# Pattern Metadata
pattern_type: "execution_pattern"
architecture: "multi_workflow"
isolation_level: "instance_based"

# Pattern Configuration
pattern_config:
  supported_workflows:
    - "DATA_ANALYSIS"
    - "REPORT_GENERATION"
    - "DOCUMENT_REGENERATION"

  features:
    instance_isolation: true
    concurrent_processing: true
    enhanced_metrics: true
    registry_system: true
    state_management: true
    routing_optimization: true

  performance_requirements:
    max_concurrent_workflows: 100
    single_operation_max_ms: 30000
    batch_operation_max_s: 300
    memory_limit_mb: 2048
    throughput_min_ops_per_second: 10.0

# Component Specifications
components:
  engine:
    class_name: "ReducerPatternEngine"
    module: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.engine"
    description: "Main orchestration engine for multi-workflow processing"

  router:
    class_name: "WorkflowRouter"
    module: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.router"
    description: "Hash-based workflow routing with load balancing"

  registry:
    class_name: "ReducerSubreducerRegistry"
    module: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.registry"
    description: "Manual subreducer registration and management"

  metrics:
    class_name: "ReducerMetricsCollector"
    module: "omnibase_core.patterns.reducer_pattern_engine.v1_0_0.metrics"
    description: "Enhanced metrics collection and aggregation"

# Subreducer Specifications
subreducers:
  data_analysis:
    class_name: "ReducerDataAnalysisSubreducer"
    module: "omnibase_core.patterns.reducer_pattern_engine.subreducers.reducer_data_analysis"
    supported_workflows: ["DATA_ANALYSIS"]
    capabilities:
      - "descriptive_statistics"
      - "correlation_analysis"
      - "trend_analysis"
      - "distribution_analysis"

  report_generation:
    class_name: "ReducerReportGenerationSubreducer"
    module: "omnibase_core.patterns.reducer_pattern_engine.subreducers.reducer_report_generation"
    supported_workflows: ["REPORT_GENERATION"]
    capabilities:
      - "json_output"
      - "html_output"
      - "csv_output"
      - "txt_output"
      - "markdown_output"

  document_regeneration:
    class_name: "ReducerDocumentRegenerationSubreducer"
    module: "omnibase_core.patterns.reducer_pattern_engine.subreducers.reducer_document_regeneration"
    supported_workflows: ["DOCUMENT_REGENERATION"]
    capabilities:
      - "template_processing"
      - "content_transformation"
      - "format_conversion"

# State Management Configuration
state_management:
  state_model: "omnibase_core.patterns.reducer_pattern_engine.models.state_transitions.WorkflowStateModel"
  validator: "omnibase_core.patterns.reducer_pattern_engine.models.state_transitions.StateTransitionValidator"

  states:
    - name: "PENDING"
      description: "Workflow awaiting processing"
      initial: true

    - name: "ROUTING"
      description: "Workflow being routed to appropriate subreducer"

    - name: "PROCESSING"
      description: "Workflow being processed by subreducer"

    - name: "COMPLETED"
      description: "Workflow processing completed successfully"
      final: true

    - name: "FAILED"
      description: "Workflow processing failed"
      final: true

  transitions:
    - from: "PENDING"
      to: "ROUTING"
      trigger: "route_workflow"

    - from: "ROUTING"
      to: "PROCESSING"
      trigger: "start_processing"

    - from: "PROCESSING"
      to: "COMPLETED"
      trigger: "complete_workflow"

    - from: "PROCESSING"
      to: "FAILED"
      trigger: "fail_workflow"

    - from: ["ROUTING", "PROCESSING"]
      to: "FAILED"
      trigger: "error_occurred"

# Dependencies
dependencies:
  - name: "container"
    type: "protocol"
    class_name: "ModelONEXContainer"
    module: "omnibase_core.core.model_onex_container"

  - name: "logger"
    type: "protocol"
    class_name: "ProtocolLogger"
    module: "omnibase.protocols.logger"

# Protocol Interfaces
protocol_interfaces:
  - "omnibase.protocols.pattern.ProtocolExecutionPattern"
  - "omnibase.protocols.workflow.ProtocolWorkflowEngine"

# Validation Rules
validation_rules:
  strict_typing_enabled: true
  input_validation_enabled: true
  output_validation_enabled: true
  performance_validation_enabled: true

  constraint_definitions:
    max_workflow_payload_size: "10MB"
    required_workflow_fields: "workflow_type,instance_id"
    supported_workflow_types: "DATA_ANALYSIS,REPORT_GENERATION,DOCUMENT_REGENERATION"

# Lifecycle Configuration
lifecycle:
  initialization_timeout_s: 60
  cleanup_timeout_s: 30
  error_recovery_enabled: true
  state_persistence_enabled: true
  health_check_interval_s: 30

# Performance Requirements
performance:
  single_operation_max_ms: 30000
  batch_operation_max_s: 300
  memory_limit_mb: 2048
  cpu_limit_percent: 80
  throughput_min_ops_per_second: 10.0

# Documentation
author: "ONEX Reducer Pattern Engine Team"
documentation_url: "https://docs.onex.ai/patterns/reducer-pattern-engine"
tags:
  - "pattern"
  - "execution"
  - "multi_workflow"
  - "phase2"
  - "reducer"
  - "orchestration"

# Schema References
subcontracts:
  - path: "contracts/workflow_contract.yaml"
  - path: "contracts/metrics_contract.yaml"
  - path: "contracts/registry_contract.yaml"
  - path: "contracts/state_management_contract.yaml"
