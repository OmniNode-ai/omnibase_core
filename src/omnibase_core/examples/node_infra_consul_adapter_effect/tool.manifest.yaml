schema_version: {major: 1, minor: 0, patch: 0}
name: "tool_infrastructure_consul_adapter_effect"
uuid: "a1b2c3d4-e5f6-7890-abcd-ef1234567890"
author: "ONEX Framework Team"
created_at: "2025-08-19T00:00:00Z"
last_modified_at: "2025-08-19T00:00:00Z"
description: "Consul Adapter - Message Bus to Consul API Bridge for infrastructure operations"
state_contract: "state_contract://consul_adapter_schema.json"
lifecycle: "active"
hash: "abcdef1234567890abcdef1234567890abcdef1234567890abcdef1234567890"
entrypoint:
  type: "python"
  target: "v1_0_0/node.py"
namespace: "omnibase.tools.infrastructure.tool_infrastructure_consul_adapter_effect"
meta_type: "tool"
runtime_language_hint: "python>=3.11"

# === INFRASTRUCTURE TOOL METADATA ===
capabilities:
  - "consul_kv_operations"
  - "consul_service_registration"
  - "consul_health_monitoring"
  - "message_bus_integration"

protocols_supported:
  - "ProtocolInfrastructureAdapter"
  - "ProtocolNodeEffect"

dependencies:
  - name: "consul_server"
    type: "external_service"
    target: "http://localhost:8500"
    binding: "runtime_lookup"
    optional: false
    description: "HashiCorp Consul server for service discovery and KV operations"

  - name: "onex_event_bus"
    type: "protocol_adherence"
    target: "ProtocolEventBus"
    binding: "injection"
    optional: false
    description: "ONEX event bus for message coordination"

# === VERSION MANAGEMENT (via x_extensions) ===
x_extensions:
  version_management:
    # Current version information
    current_stable: {major: 1, minor: 0, patch: 0}
    current_development: null

    # Version catalog with lifecycle states
    versions:
      v1_0_0:
        version: {major: 1, minor: 0, patch: 0}
        status: "active"
        release_date: "2025-08-19"
        breaking_changes: false
        recommended: true
        deprecation_date: null
        end_of_life: null

      v0_9_0:
        version: {major: 0, minor: 9, patch: 0}
        status: "deprecated"
        release_date: "2025-08-01"
        breaking_changes: true
        recommended: false
        deprecation_date: "2025-08-15"
        end_of_life: "2025-12-01"

    # Discovery configuration for services loading this tool
    discovery:
      auto_load_strategy: "current_stable" # current_stable | current_development | latest
      fallback_versions: [{major: 1, minor: 0, patch: 0}] # Fallback versions if preferred unavailable
      version_directory_pattern: "v{major}_{minor}_{patch}"
      implementation_file: "node.py"
      contract_file: "contract.yaml"
      main_class_name: "ConsulAdapter"

    # Service loading configuration
    service_integration:
      load_as_module: true # Loaded by service, not standalone
      requires_separate_port: false # No separate HTTP port needed
      initialization_order: 2 # Load after orchestrator (1), before reducer (3)
      shutdown_timeout: 30 # Graceful shutdown timeout
      health_check_via_service: true # Health checked by parent service

# === EXECUTION METADATA ===
execution_mode: "async"
execution_constraints:
  max_memory_mb: 128
  max_cpu_percent: 25
  timeout_seconds: 30

# === TESTING METADATA ===
testing:
  required_ci_tiers:
    - "mock"
    - "integration"
  minimum_coverage_percentage: 85.0
  canonical_test_case_ids:
    - "test_consul_kv_operations"
    - "test_consul_service_registration"
    - "test_consul_health_monitoring"

# === SECURITY METADATA ===
data_handling_declaration:
  processes_sensitive_data: false
  data_classification: "internal"

security_context:
  requires_network_access: true
  external_endpoints:
    - "http://localhost:8500" # Consul API

# === LOGGING CONFIGURATION ===
logging_config:
  level: "info"
  format: "json"
  audit_events:
    - "adapter_initialized"
    - "consul_operation_completed"
    - "consul_connection_failure"

tags:
  - "infrastructure"
  - "consul"
  - "adapter"
  - "service-discovery"
  - "kv-store"
