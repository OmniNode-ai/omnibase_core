# Infrastructure Orchestrator - ONEX Contract
# Orchestrator node for infrastructure workflow coordination

# === REQUIRED ROOT FIELDS ===
contract_version: {major: 1, minor: 0, patch: 0}
node_name: tool_infrastructure_orchestrator
node_version: {major: 1, minor: 0, patch: 0}
contract_name: "tool_infrastructure_orchestrator_contract"
name: "infrastructure_orchestrator"
version: "1.0.0"
description: "Infrastructure Orchestrator - Maintains infrastructure connections and coordinates on-demand adapter tools"
node_type: "ORCHESTRATOR"
input_model: "ModelInfrastructureOrchestratorInput"
output_model: "ModelInfrastructureOrchestratorOutput"

# === TOOL SPECIFICATION ===
tool_specification:
  tool_name: "tool_infrastructure_orchestrator"
  version: "1.0.0"
  description: "Infrastructure Orchestrator - Maintains infrastructure connections and coordinates on-demand adapter tools"
  main_tool_class: "InfrastructureOrchestrator"
  container_injection: "ONEXContainer"
  business_logic_pattern: "coordination"

# === DEPENDENCIES ===
dependencies:
  - "omnibase.protocol.protocol_consul_client"
  - "omnibase.protocol.protocol_event_bus"
  - "omnibase.protocol.protocol_file_system"

# === WORKFLOW REGISTRY (Required for ORCHESTRATOR nodes) ===
workflow_registry:
  workflows:
    infrastructure_startup:
      workflow_id: "infrastructure_startup"
      workflow_name: "Infrastructure Startup Sequence"
      workflow_type: "sequential"
      steps:
        - step_name: "consul_health_check"
          step_type: "health_check"
          timeout_ms: 5000
        - step_name: "vault_initialization"
          step_type: "service_init"
          timeout_ms: 10000
        - step_name: "kafka_cluster_verify"
          step_type: "cluster_check"
          timeout_ms: 8000
      dependencies: []
      priority: 100
    infrastructure_shutdown:
      workflow_id: "infrastructure_shutdown"
      workflow_name: "Infrastructure Graceful Shutdown"
      workflow_type: "sequential"
      steps:
        - step_name: "drain_kafka_queues"
          step_type: "graceful_drain"
          timeout_ms: 30000
        - step_name: "vault_token_revoke"
          step_type: "cleanup"
          timeout_ms: 5000
        - step_name: "consul_deregister"
          step_type: "deregister"
          timeout_ms: 3000
      dependencies: []
      priority: 200
  default_workflow_id: "infrastructure_startup"
  workflow_selection_strategy: "explicit"
  max_concurrent_workflows: 3

# === PERFORMANCE (Required for ORCHESTRATOR nodes) ===
performance:
  single_operation_max_ms: 1000

# === TOOL SPECIFICATION ===
tool_specification:
  main_tool_class: "InfrastructureOrchestrator"
  container_injection: "ONEXContainer"
  business_logic_pattern: "coordination"
