# Infrastructure Consul Adapter - ONEX Contract
# Effect node for consul API operations via message bus integration

# === REQUIRED ROOT FIELDS ===
contract_version: {major: 1, minor: 0, patch: 0}
node_name: "tool_infrastructure_consul_adapter_effect"
node_version: {major: 1, minor: 0, patch: 0}
contract_name: "tool_infrastructure_consul_adapter_effect_contract"
description: "Infrastructure Consul Adapter - Message Bus to Consul API Bridge"
node_type: "EFFECT"
name: "tool_infrastructure_consul_adapter_effect"
version: {major: 1, minor: 0, patch: 0}
input_model: "ModelConsulAdapterInput"
output_model: "ModelConsulAdapterOutput"

# === TOOL SPECIFICATION ===
tool_specification:
  tool_name: "tool_infrastructure_consul_adapter_effect"
  version: {major: 1, minor: 0, patch: 0}
  description: "Infrastructure Consul Adapter - Message Bus to Consul API Bridge"
  main_tool_class: "NodeCanaryEffect"
  container_injection: "ONEXContainer"
  business_logic_pattern: "effect"

# === DEPENDENCIES ===
dependencies:
  - name: "protocol_consul_client"
    type: "protocol"
    class_name: "ProtocolConsulClient"
    module: "omnibase.protocol.protocol_consul_client"
  - name: "protocol_event_bus"
    type: "protocol"
    class_name: "ProtocolEventBus"
    module: "omnibase.protocol.protocol_event_bus"
  - name: "protocol_file_system"
    type: "protocol"
    class_name: "ProtocolFileSystem"
    module: "omnibase.protocol.protocol_file_system"

# === EVENT TYPE CONFIGURATION ===
event_type:
  primary_events: ["consul_kv_operation", "consul_service_operation", "consul_health_check"]
  event_categories: ["infrastructure", "service_discovery", "configuration"]
  publish_events: true
  subscribe_events: false
  event_routing: "infrastructure"

# === INPUT/OUTPUT STATE ===
input_state:
  object_type: "object"
  required:
    - "action"
    - "operation_type"
  properties:
    action:
      property_type: "string"
      enum: ["consul_kv_get", "consul_kv_put", "consul_kv_delete", "consul_service_register", "consul_service_deregister", "health_check"]
      description: "Consul operation to perform"
    operation_type:
      property_type: "string"
      description: "Type of consul operation"
    key_path:
      property_type: "string"
      description: "Consul key-value path"
    value_data:
      property_type: "object"
      description: "Data for put operations"
    service_config:
      property_type: "object"
      description: "Service registration configuration"
    recurse:
      property_type: "boolean"
      description: "Recursive deletion for KV operations (optional)"

output_state:
  object_type: "object"
  properties:
    operation_result:
      property_type: "object"
      description: "Result of the consul operation"
    kv_data:
      property_type: "object"
      description: "Retrieved key-value data"
    service_id:
      property_type: "string"
      description: "Registered service ID"
    success:
      property_type: "boolean"
      description: "Whether operation succeeded"
    error_message:
      property_type: "string"
      description: "Error message if operation failed"

# === IO OPERATIONS (Required for EFFECT nodes) ===
io_operations:
  - operation_type: "consul_kv_get"
    atomic: true
    backup_enabled: false
    permissions: null
    recursive: false
    buffer_size: 8192
    timeout_seconds: 5
    validation_enabled: true
  - operation_type: "consul_kv_put"
    atomic: true
    backup_enabled: true
    permissions: null
    recursive: false
    buffer_size: 8192
    timeout_seconds: 5
    validation_enabled: true
  - operation_type: "consul_service_register"
    atomic: true
    backup_enabled: false
    permissions: null
    recursive: false
    buffer_size: 8192
    timeout_seconds: 10
    validation_enabled: true
  - operation_type: "health_check"
    atomic: false
    backup_enabled: false
    permissions: null
    recursive: false
    buffer_size: 4096
    timeout_seconds: 3
    validation_enabled: true

# === SERVICE CONFIGURATION ===
service_configuration:
  is_persistent_service: false
  default_port: 8087

  # Consul adapter HTTP endpoints
  http_endpoints:
    - path: "/health"
      method: "GET"
      description: "Consul adapter health status"
    - path: "/consul/status"
      method: "GET"
      description: "Get current consul connection status"
    - path: "/consul/kv"
      method: "GET"
      description: "List consul key-value pairs"

# === ACTIONS ===
actions:
  - name: "consul_operation"
    description: "Perform consul API operation"
    inputs: ["action", "operation_type"]
  - name: "health_check"
    description: "Check consul adapter health"
    inputs: []

# === DEFINITIONS (Required by ModelContractContent) ===
definitions:
  models: {}
  schemas: {}
  responses: {}
