# ONEX Core Pre-commit Configuration
# Uses shared ONEX hook templates to demonstrate ecosystem integration

repos:
  # YAML formatting (standard across ecosystem)
  - repo: https://github.com/google/yamlfmt
    rev: v0.17.2
    hooks:
      - id: yamlfmt
        args: [--formatter, retain_line_breaks=true]
        exclude: ^(work_tickets/|tests/fixtures/validation/invalid/)

  # Essential file formatting (standard across ecosystem)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v6.0.0
    hooks:
      - id: trailing-whitespace
        args: [--markdown-linebreak-ext=md]
      - id: end-of-file-fixer
      - id: check-merge-conflict
      - id: check-added-large-files
        args: [--maxkb=1000]

  # ONEX Python Development Hooks (from shared templates)
  - repo: https://github.com/psf/black
    rev: 25.9.0
    hooks:
      - id: black
        name: Black Python Formatter
        args: [--line-length, "88", --target-version, py311]
        exclude: ^tests/fixtures/validation/edge_cases/syntax_error\.py$

  - repo: https://github.com/pycqa/isort
    rev: 6.0.1
    hooks:
      - id: isort
        name: isort Import Sorter
        args: [--profile, black, --line-length, "88"]
        exclude: ^tests/fixtures/validation/edge_cases/syntax_error\.py$

  # ONEX Framework Validation (from shared templates)
  - repo: local
    hooks:
      # MyPy Type Checking
      - id: mypy-poetry
        name: MyPy Type Checking (via Poetry)
        entry: poetry run mypy
        language: system
        types: [python]
        args: [--config-file=mypy.ini, --show-error-codes, --no-error-summary]
        files: ^src/omnibase_core/(core|models|enums|exceptions|decorators).*\.py$
        exclude: ^(tests/|src/omnibase_core/examples|src/omnibase_core/core/contracts/model_contract_effect|archive/|archived/).*\.py$

      # ONEX Core Framework Validation (SHARED HOOKS)
      - id: validate-repository-structure
        name: ONEX Repository Structure Validation
        entry: poetry run python scripts/validation/validate_structure.py
        args: ['.', 'omnibase_core']
        language: system
        always_run: true
        pass_filenames: false
        stages: [pre-commit]

      - id: validate-naming-conventions
        name: ONEX Naming Convention Validation
        entry: poetry run python scripts/validation/validate_naming.py
        args: ['.']
        language: system
        always_run: true
        pass_filenames: false
        stages: [pre-commit]

      - id: validate-string-versions-and-ids
        name: ONEX String Version & ID Type Validation (AST + Regex)
        entry: poetry run python scripts/validation/validate-string-versions.py
        args: [--dir, src/omnibase_core/]
        language: system
        always_run: true
        pass_filenames: false
        exclude: ^(archive/|archived/|tests/fixtures/validation/)
        stages: [pre-commit]

      - id: validate-no-backward-compatibility
        name: ONEX Backward Compatibility Anti-Pattern Detection
        entry: poetry run python scripts/validation/validate-no-backward-compatibility.py
        args: ['-d', 'src/']
        language: system
        pass_filenames: false
        files: ^.*\.py$
        exclude: ^(scripts/validation/validate-no-backward-compatibility\.py|archived/.*)$
        stages: [pre-commit]

      - id: validate-no-manual-yaml
        name: ONEX Manual YAML Prevention
        entry: poetry run python scripts/validation/validate-no-manual-yaml.py
        language: system
        pass_filenames: true
        files: ^.*\.py$
        exclude: ^(scripts/validation/validate-contracts\.py|scripts/validation/validate-string-versions\.py|tests/fixtures/validation/)
        stages: [pre-commit]

      - id: validate-one-model-per-file
        name: ONEX One-Model-Per-File Architecture Validation
        entry: poetry run python scripts/validation/validate-one-model-per-file.py
        args: [src/omnibase_core/models/, --max-violations, "0"]
        language: system
        always_run: true
        pass_filenames: false
        stages: [pre-commit]

      # ONEX Python Pattern Validation (SHARED HOOKS)
      - id: validate-pydantic-patterns
        name: ONEX Pydantic Pattern Validation
        entry: poetry run python scripts/validation/validate-pydantic-patterns.py
        language: system
        pass_filenames: false
        files: ^src/.*\.py$
        stages: [pre-commit]

      - id: validate-union-usage
        name: ONEX Union Usage Validation
        entry: poetry run python scripts/validation/validate-union-usage.py
        args: ['--max-unions', '0']
        language: system
        pass_filenames: false
        files: ^src/.*\.py$
        stages: [pre-commit]

      - id: validate-generic-patterns
        name: ONEX Generic Pattern Validation
        entry: poetry run python scripts/validation/validate-generic-patterns.py
        args: ['src/omnibase_core/', '--max-violations', '0']
        language: system
        pass_filenames: false
        files: ^src/.*\.py$
        stages: [pre-commit]

      - id: validate-dict-any-usage
        name: ONEX Dict[str, Any] Anti-Pattern Detection
        entry: poetry run python scripts/validation/validate-dict-any-usage.py
        args: ['--max-violations', '0']
        language: system
        pass_filenames: false
        files: ^src/.*\.py$
        stages: [pre-commit]

      - id: validate-no-dict-conversion
        name: ONEX Dict Conversion Anti-Pattern Detection
        entry: poetry run python scripts/validation/validate-no-dict-conversion.py
        args: ['--max-violations', '0']
        language: system
        pass_filenames: false
        files: ^src/.*\.py$
        exclude: ^(tests/|archive/|archived/).*\.py$
        stages: [pre-commit]

      - id: validate-no-dict-methods
        name: ONEX Dict Methods Anti-Pattern Detection (from_dict/to_dict banned)
        entry: poetry run python scripts/validation/validate-no-dict-methods.py
        args: ['--max-violations', '0']
        language: system
        pass_filenames: false
        files: ^src/.*\.py$
        exclude: ^(tests/|archive/|archived/|scripts/).*\.py$
        stages: [pre-commit]

      - id: validate-anti-pattern-names
        name: ONEX Anti-Pattern Name Detection (simple/mock/basic/wrapper banned)
        entry: poetry run python scripts/validation/validate-anti-pattern-names.py
        args: ['--max-violations', '0']
        language: system
        pass_filenames: false
        files: ^src/.*\.py$
        exclude: ^(tests/|archive/|archived/|scripts/).*\.py$
        stages: [pre-commit]

      # Repository-specific validation (omnibase_core only)
      - id: validate-contracts
        name: ONEX Contract Validation
        entry: poetry run python scripts/validation/validate-contracts.py
        language: system
        pass_filenames: false
        files: ^src/omnibase_core/(nodes|protocol|core).*\.py$
        exclude: ^tests/fixtures/validation/invalid/
        stages: [pre-commit]

      - id: audit-optional-usage
        name: ONEX Optional Type Usage Audit
        entry: poetry run python scripts/validation/audit_optional.py
        args: ['.']
        language: system
        always_run: true
        pass_filenames: false
        stages: [pre-commit]

      - id: validate-string-typing
        name: ONEX String Typing Anti-Pattern Detection
        entry: poetry run python scripts/validation/validate-string-typing.py
        args: ['--config', 'scripts/validation/string-typing-config.json', '--dir', 'src/omnibase_core/models/']
        language: system
        always_run: true
        pass_filenames: false
        files: ^src/omnibase_core/models/.*\.py$
        exclude: ^(tests/|archive/|archived/|scripts/).*\.py$
        stages: [pre-commit]

      - id: validate-typing-syntax
        name: ONEX Typing Syntax Validation (Optional/Union â†’ Modern Syntax)
        entry: poetry run python scripts/validation/validate-typing-syntax.py
        args: ['--max-violations', '0']
        language: system
        pass_filenames: false
        files: ^src/.*\.py$
        exclude: ^(tests/|archive/|archived/|scripts/).*\.py$
        stages: [pre-commit]

    # COMPREHENSIVE ONEX STANDARDS VALIDATION (SHARED) - Disabled for now due to local fallback issues
    # This demonstrates how other repositories would use the shared validation
    # - id: validate-onex-standards
    #   name: ONEX Standards Comprehensive Validation
    #   entry: python -c "from omnibase_core.validation import validate_onex_standards; import sys; result = validate_onex_standards('.'); sys.exit(0 if result['success'] else 1)"
    #   language: system
    #   always_run: true
    #   pass_filenames: false
    #   stages: [commit]

# Configuration
ci:
  autofix_commit_msg: |
    [pre-commit.ci] auto fixes for omnibase_core

    for more information, see https://pre-commit.ci
  autofix_prs: true
  autoupdate_schedule: weekly
  submodules: false
