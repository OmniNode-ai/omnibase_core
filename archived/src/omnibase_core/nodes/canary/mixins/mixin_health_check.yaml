# ONEX Mixin: Health Check
# Provides standardized health monitoring capabilities for all node types

mixin_name: "mixin_health_check"
mixin_version: {major: 1, minor: 0, patch: 0}
description: "Standardized health monitoring and status reporting for ONEX nodes"
applicable_node_types: ["COMPUTE", "EFFECT", "REDUCER", "ORCHESTRATOR"]

# === HEALTH CHECK ACTIONS ===
actions:
  - name: "health_check"
    description: "Check overall health status of the node and its dependencies"
    inputs: []
    outputs: ["health_status", "component_health", "dependency_health"]
    required: true
    timeout_ms: 5000

  - name: "component_health_check"
    description: "Check health of individual node components"
    inputs: ["component_name"]
    outputs: ["component_status", "component_details"]
    required: false
    timeout_ms: 3000

# === HEALTH STATUS DEFINITIONS ===
health_status_levels:
  - HEALTHY: "All systems operational"
  - DEGRADED: "Some non-critical issues detected"
  - UNHEALTHY: "Critical issues affecting functionality"
  - CRITICAL: "Node cannot function properly"
  - ERROR: "Health check system failure"

# === HEALTH CHECK CONFIGURATION ===
health_check_config:
  check_interval_ms: 30000 # 30 seconds
  failure_threshold: 3
  recovery_threshold: 2
  timeout_ms: 5000
  include_dependency_checks: true
  include_component_checks: true

# === OUTPUT MODELS ===
output_models:
  health_status:
    status: "enum[HEALTHY,DEGRADED,UNHEALTHY,CRITICAL,ERROR]"
    message: "string"
    timestamp: "datetime"
    check_duration_ms: "integer"

  component_health:
    components:
      type: "array"
      items:
        component_name: "string"
        status: "enum[HEALTHY,DEGRADED,UNHEALTHY,CRITICAL,ERROR]"
        message: "string"
        last_check: "datetime"

# === DEPENDENCIES PROVIDED ===
dependencies:
  - name: "health_monitoring"
    type: "capability"
    description: "Provides health monitoring capabilities"

# === METRICS ===
metrics:
  - name: "health_check_count"
    type: "counter"
    description: "Total number of health checks performed"

  - name: "health_check_duration"
    type: "histogram"
    description: "Time taken for health checks"

  - name: "health_status_changes"
    type: "counter"
    description: "Number of health status changes"
    labels: ["from_status", "to_status"]
