[mypy]
# ONEX MyPy Configuration - Optimized for Maximum Type Safety
# Aligned with omnibase_3 parent project standards
# Updated for Python 3.12 with strict typing enforcement
# Last optimized: 2025-12-24

python_version = 3.12

# Error reporting
# Temporarily disable to handle git dependency import issues
warn_return_any = False
warn_unused_configs = True
# Allow redundant casts for type clarity
warn_redundant_casts = False
# Allow unused ignores for flexibility
warn_unused_ignores = False
warn_no_return = True
warn_unreachable = True

# Type checking strictness
disallow_untyped_defs = True
disallow_incomplete_defs = True
check_untyped_defs = True
# Allow untyped decorators for Pydantic validators
disallow_untyped_decorators = False
disallow_any_unimported = False
disallow_any_expr = False
disallow_any_decorated = False
# DICT_STR_ANY_PREVENTION (2025-12-24):
# Enabled to prevent new dict[str, Any] usage. Violations emit [explicit-any] error.
# Legacy modules have overrides below - DO NOT add new modules to overrides.
# See docs/architecture/DICT_STR_ANY_PREVENTION.md for migration guide.
disallow_any_explicit = True
disallow_any_generics = True
# Temporarily disable to handle git dependency import issues
disallow_subclassing_any = False

# Optional handling
no_implicit_optional = True
strict_optional = True

# Miscellaneous strictness
strict_equality = True
extra_checks = True
show_error_codes = True
enable_error_code = unused-awaitable

# Handle third-party imports
ignore_missing_imports = True

# Exclude archived directories and duplicate scripts to avoid module conflicts
exclude = (?x)(
    ^archived/.*$ |
    ^archive/.*$ |
    ^scripts/validate-contracts\.py$ |
    ^scripts/validate-no-backward-compatibility\.py$ |
    ^scripts/validate-no-manual-yaml\.py$ |
    ^scripts/validate-pydantic-patterns\.py$ |
    ^scripts/validate-string-versions\.py$ |
    ^scripts/validate-union-usage\.py$
    )

# Per-module overrides for specific patterns
# Tests are allowed to be less strict for rapid development and mocking
[mypy-tests.*]
disallow_untyped_defs = False
disallow_any_generics = False
disallow_any_explicit = False

# Scripts are utility code and can be less strict for simplicity
[mypy-scripts.*]
disallow_untyped_defs = False
disallow_any_generics = False
disallow_any_explicit = False

# =============================================================================
# LEGACY DICT[STR, ANY] TECH DEBT (2025-12-24)
# =============================================================================
# These modules contain legacy dict[str, Any] usage that predates the
# disallow_any_explicit = True enforcement. They are EXCLUDED from the check
# to avoid breaking existing code.
#
# RULES:
# 1. DO NOT add new modules to this list - fix the types instead
# 2. When modifying files in these modules, migrate away from dict[str, Any]
# 3. Remove modules from this list once they're fully migrated
#
# Migration priority (by error count):
# - models/* (1685 errors) - Highest priority, most impact
# - mixins/* (114 errors)
# - utils/* (52 errors)
# - Other modules (<25 errors each)
#
# See docs/architecture/DICT_STR_ANY_PREVENTION.md for migration guide.
# =============================================================================

# Models - 1685 legacy explicit-any usages (85% of total)
# This is the primary tech debt area. Use ModelSchemaValue instead of dict[str, Any].
[mypy-omnibase_core.models.*]
disallow_any_explicit = False

# Mixins - 114 legacy explicit-any usages
[mypy-omnibase_core.mixins.*]
disallow_any_explicit = False

# Utils - 52 legacy explicit-any usages
[mypy-omnibase_core.utils.*]
disallow_any_explicit = False

# Logging - 23 legacy explicit-any usages
[mypy-omnibase_core.logging.*]
disallow_any_explicit = False

# Decorators - 21 legacy explicit-any usages
[mypy-omnibase_core.decorators.*]
disallow_any_explicit = False

# Infrastructure - 12 legacy explicit-any usages
[mypy-omnibase_core.infrastructure.*]
disallow_any_explicit = False

# Errors - 12 legacy explicit-any usages
[mypy-omnibase_core.errors.*]
disallow_any_explicit = False

# Types - 11 legacy explicit-any usages
[mypy-omnibase_core.types.*]
disallow_any_explicit = False

# Runtime - 11 legacy explicit-any usages
[mypy-omnibase_core.runtime.*]
disallow_any_explicit = False

# Protocols - 10 legacy explicit-any usages
[mypy-omnibase_core.protocols.*]
disallow_any_explicit = False

# Nodes - 10 legacy explicit-any usages
[mypy-omnibase_core.nodes.*]
disallow_any_explicit = False

# Container - 9 legacy explicit-any usages
[mypy-omnibase_core.container.*]
disallow_any_explicit = False

# Services - 5 legacy explicit-any usages
[mypy-omnibase_core.services.*]
disallow_any_explicit = False

# Validation - legacy explicit-any usages in validation logic
[mypy-omnibase_core.validation.*]
disallow_any_explicit = False

# Tools - Contains mypy plugins which need Any for plugin API
[mypy-omnibase_core.tools.*]
disallow_any_explicit = False

# Pipeline - Pydantic BaseModel triggers [explicit-any] in class definitions
# This is due to Pydantic's internal type system, not user code
[mypy-omnibase_core.pipeline.*]
disallow_any_explicit = False

# Hooks - Pydantic BaseModel triggers [explicit-any] in class definitions
# This is NOT legacy tech debt - it's Pydantic's internal type system (same as pipeline)
# Added for OMN-1474: Claude Code hook input types
[mypy-omnibase_core.models.hooks.*]
disallow_any_explicit = False

# =============================================================================
# END LEGACY OVERRIDES
# =============================================================================

# OPTIMIZATION NOTE: Removed Pydantic model overrides
# Pydantic decorators (@field_validator, @model_validator, @field_serializer, @computed_field)
# now work properly with strict typing in modern Pydantic versions (2.0+)
# Previous overrides for disallow_untyped_decorators and warn_return_any are no longer needed
